{% extends "base.html" %}
{% block content %}
<div class="container pb-5">
    <h2 class="mb-4"> dmin Panel</h2>

    <h4 class="text-warning mb-3"><i class="bi bi-person-check"></i> 1. Verification Requests</h4>
    {% if not users %}
        <div class="alert alert-success glass-card mb-5 border-0">All users have been verified.</div>
    {% else %}
        <div class="row mb-5">
            {% for user in users %}
            <div class="col-md-6 col-lg-4">
                <div class="glass-card p-3 mb-4">
                    <h5>Email: <span class="text-info">{{ user[1] }}</span></h5>
                    <hr class="border-secondary">
                    <img src="{{ url_for('static', filename='uploads/' + user[2]) }}" class="img-fluid rounded mb-3" style="max-height: 200px; width: 100%; object-fit: contain; background: #000;">
                    
                    <a href="/approve/{{ user[0] }}" class="btn btn-success w-100 mb-2 fw-bold">APPROVE</a>
                    
                    <form action="/reject/{{ user[0] }}" method="POST">
                        <div class="input-group">
                            <input type="text" name="reason" class="form-control" placeholder="Rejection reason..." required>
                            <button class="btn btn-danger" type="submit">Reject</button>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    {% endif %}

    <h4 class="text-success mb-3"><i class="bi bi-cart-check"></i> 2. New Wholesale Orders</h4>
    <div class="glass-card p-4 mb-5 border-0">
        {% if not orders %}
            <p class="text-white-50">No orders found in the database.</p>
        {% else %}
            <div class="table-responsive">
                <table class="table table-dark table-striped align-middle mb-0" style="background: transparent;">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Partner Email</th>
                            <th>Stock Items</th>
                            <th>Total (₸)</th>
                            <th>Delivery Address</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            <td class="fw-bold text-info">#{{ order[0] }}</td>
                            <td>{{ order[1] }}</td>
                            <td style="max-width: 250px;">{{ order[2] }}</td>
                            <td class="text-warning fw-bold">{{ order[3] }} ₸</td>
                            <td>{{ order[4] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>

    <h4 class="text-danger mb-3"><i class="bi bi-shield-lock"></i> 3. Password Reset Requests</h4>
    <div class="glass-card p-4 mb-5 border-0">
        {% if not pwd_requests %}
            <p class="text-white-50">No pending password reset requests.</p>
        {% else %}
            <div class="table-responsive">
                <table class="table table-dark table-hover mb-0" style="background: transparent;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>User Email</th>
                            <th>Request Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in pwd_requests %}
                        <tr>
                            <td>#{{ req[0] }}</td>
                            <td class="text-info">{{ req[1] }}</td>
                            <td>{{ req[2] }}</td>
                            <td>
                                <div class="btn-group">
                                    <a href="/admin/approve_reset/{{ req[0] }}" class="btn btn-sm btn-success">
                                        <i class="bi bi-check-circle-fill"></i> Approve & Generate
                                    </a>
                                    <a href="/admin/reject_reset/{{ req[0] }}" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-x-circle"></i> Reject
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>

    <h4 class="text-info mb-3"><i class="bi bi-box-seam"></i> 4. Inventory Management</h4>
    <div class="glass-card p-4 border-0">
        <div class="table-responsive">
            <table class="table table-dark table-hover align-middle mb-0" style="background: transparent;">
                <thead>
                    <tr>
                        <th>SKU ID</th>
                        <th>Preview</th>
                        <th>Product Name</th>
                        <th>Wholesale Price</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in products %}
                    <tr>
                        <td>{{ p.id }}</td>
                        <td><img src="{{ p.img }}" width="50" height="50" style="object-fit: contain;" class="rounded bg-white"></td>
                        <td>{{ p.name }}</td>
                        <td class="text-info fw-bold">{{ p.price }} ₸</td>
                        <td>
                            <button class="btn btn-outline-info btn-sm" data-bs-toggle="modal" data-bs-target="#editModal{{ p.id }}">
                                <i class="bi bi-pencil-square"></i> Edit
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% for p in products %}
<div class="modal fade" id="editModal{{ p.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);">
            <div class="modal-header border-0">
                <h5 class="modal-title text-dark fw-bold">Edit Stock Item: {{ p.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/admin/edit_product" method="POST">
                <div class="modal-body text-start">
                    <input type="hidden" name="id" value="{{ p.id }}">
                    
                    <div class="mb-3">
                        <label class="form-label text-dark fw-bold small text-uppercase">Wholesale Price (₸)</label>
                        <input type="number" name="price" class="form-control border-secondary text-dark" value="{{ p.price }}" required style="background: white;">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label text-dark fw-bold small text-uppercase">Description</label>
                        <textarea name="desc" class="form-control border-secondary text-dark" rows="4" required style="background: white;">{{ p.desc }}</textarea>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-success rounded-pill px-4 fw-bold shadow">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endfor %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}